(function(e,t,i){"use strict";"function"==typeof define&&define.amd?define(i):t[e]=i()})("Form",this,function(e,t){"use strict";function i(e,t){var s=null;for(s in t)t.hasOwnProperty(s)&&(t[s]&&t[s].constructor&&t[s].constructor===Object?(e[s]=e[s]||{},i(e[s],t[s])):e[s]=t[s]);return e}function s(e,t){this.DOMElement=e,this.parent=t,this.init()}function r(e,t){this.element=e,this.options=i(l,t),this.init()}e=e||"Form",t=t||this;var l={augmentHTML5:!0,customErrorMessage:!1,displayMessages:!0,listMessages:!0,listTitle:"We couldn't submit the form, please check your answers:",errorMessagesClass:"form-error-message",errorMessageElement:"p",errorMessages:{valueMissing:{text:"This field is required",email:"This field is required",tel:"This field is required",checkbox:"Check at least one of the required boxes",radio:"Select one of the required radio options"},patternMismatch:{tel:"Enter a valid phone number",email:"Enter a valid email address",text:"Please match the requested format"}},patterns:{email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",tel:"[\\w\\d\\s\\(\\)\\.+-]+"},fail:function(){},pass:!1};return s.prototype={init:function(){this.ph="placeholder"in document.createElement("input"),this.type=this.DOMElement.getAttribute("type")||"text",this.isGrouped="checkbox"===this.DOMElement.getAttribute("type")||"radio"===this.DOMElement.getAttribute("type"),this.DOMElement.validityState=this.DOMElement.validityState||this.defaultValidityState(),this.DOMElement.checkValidity=this.DOMElement.checkValidity||this.getValidityState,this.ph||this.placeHolder()},defaultValidityState:function(){return{valid:!1,stepMismatch:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,tooLong:!1,typeMismatch:!1,valueMissing:!0}},getValidityState:function(){return this.validityState.valid},setValidityState:function(){var e,t=this.DOMElement.getAttribute("pattern")||this.parent.options.patterns[this.type],i=null;return""!==this.DOMElement.value&&("radio"!==this.type&&"checkbox"!==this.type||this.DOMElement.checked)?(this.DOMElement.validityState.valueMissing=!1,e=RegExp(t,""),e.test(this.DOMElement.value)?this.DOMElement.validityState.valid=!0:(this.DOMElement.validityState.valid=!1,this.DOMElement.validityState.patternMismatch=!0,i=this.parent.options.errorMessages.patternMismatch[this.type])):(this.DOMElement.validityState.valid=!1,this.DOMElement.validityState.valueMissing=!0,i=this.parent.options.errorMessages.valueMissing[this.type]),this.DOMElement.validationMessage=i,this},placeHolder:function(){var e=function(e){e.stopPropagation(),this.value="",this.className=this.className.split("form-placeholder").join("")},t=function(e){e.stopPropagation(),""===this.value&&(this.value=this.getAttribute("placeholder"),this.className+=" form-placeholder")};this.DOMElement.getAttribute("placeholder")&&(this.DOMElement.addEventListener("focus",e,!1),this.DOMElement.addEventListener("blur",t,!1),""===this.DOMElement.value&&(this.DOMElement.value=this.DOMElement.getAttribute("placeholder"),this.DOMElement.className+=" form-placeholder"))},clearPlaceholder:function(){return this.DOMElement.value===this.DOMElement.getAttribute("placeholder")&&(this.DOMElement.value=""),this},getError:function(){var e=null;return this.DOMElement.value,this.DOMElement.getAttribute("pattern")||this.parent.options.patterns[this.type],this.ph||this.clearPlaceholder(),this.parent.HTML5||this.setValidityState(),e=this.DOMElement.checkValidity(),e?(this.isGrouped&&(this.parent.groups[this.DOMElement.getAttribute("name")]="checked",this.parent.errorList[this.DOMElement.getAttribute("name")].error=null),!1):this.parent.options.customErrorMessage?this.isGrouped?"checked"!==this.parent.groups[this.DOMElement.getAttribute("name")]?(this.parent.groups[this.DOMElement.getAttribute("name")]="not-checked",this.parent.options.errorMessages.valueMissing[this.type]):void 0:this.DOMElement.validity.valueMissing&&this.parent.options.errorMessages.valueMissing[this.type]||this.DOMElement.validity.patternMismatch&&this.parent.options.errorMessages.patternMismatch[this.type]:this.DOMElement.validationMessage}},r.prototype={HTML5:!1,groups:[],init:function(){var e=0,t=0;if(this.HTML5="noValidate"in document.createElement("form"),!this.HTML5||this.options.augmentHTML5){for(this.fields=this.element.querySelectorAll("input, textarea"),this.validatebleElements={},t=this.fields.length,this.element.querySelector("input[type=submit]").addEventListener("click",this,!1),this.element.querySelector("input[type=submit]").addEventListener("onkeypress",this,!1),e=0;t>e;e+=1)"submit"!==this.fields[e].getAttribute("type")&&null!==this.fields[e].getAttribute("required")&&"hidden"!==this.fields[e].getAttribute("type")&&null===this.fields[e].getAttribute("novalidate")&&(this.validatebleElements[this.fields[e].getAttribute("id")]=new s(this.fields[e],this));this.makeErrorList()}},handleEvent:function(e){(!this.HTML5||this.options.augmentHTML5)&&"click"===e.type&&(e.preventDefault(),this.clearErrors().test())},writeInline:function(e){var t=this,i=document.createElement(t.options.errorMessageElement);return i.textContent=e,i.className=t.options.errorMessagesClass,i.setAttribute("role","alert"),i},clearErrors:function(){var e=this,t=null,i=null,s=e.fields.length;if(e.element.querySelectorAll(".form-error").length>0)for(i=0;s>i;i+=1)e.fields[i].className.indexOf("form-error")>-1&&(e.fields[i].className=e.fields[i].className.split("form-error").join(""),e.options.listMessages||(e.fields[i].removeAttribute("aria-labelledBy"),e.fields[i].removeAttribute("aria-invalid"),t=e.fields[i].nextElementSibling,t&&t.parentNode.removeChild(t)));return e},listErrorMessages:function(){var e=this,t=this.element.querySelector(".form-error-list"),i=document.createElement("dl"),s=document.createElement("dt"),r=document.createElement("dd"),l=document.createElement("ol"),n=document.createElement("li"),a=document.createElement("a"),o=null,h=null,d=null;e.errorList.length,t&&t.parentElement.removeChild(t),s.innerHTML=e.options.listTitle,i.appendChild(s),i.appendChild(r),i.className="form-error-list",i.setAttribute("role","alert"),r.appendChild(l);for(d in e.errorList)e.errorList.hasOwnProperty(d)&&"hasErrors"!==d&&e.errorList[d].error&&(o=n.cloneNode(!0),h=a.cloneNode(!0),h.setAttribute("href","#"+e.errorList[d].id),h.setAttribute("id",d+"-error"),h.innerHTML=e.errorList[d].error,o.appendChild(h),l.appendChild(o));e.element.insertBefore(i,e.element.firstChild),window.scrollTo(0,i.offsetTop),i.focus()},displayInlineErrorMessages:function(){var e=this,t=null,i=null,s=null,r=null,l=null;console.log("To do\n - test displaying of inline errors");for(t in e.errorList)e.errorList.hasOwnProperty(t)&&"hasErrors"!==t&&(r=e.writeInline(e.errorList[t].error),i=null!==document.getElementById(t)?document.getElementById(e.errorList[t].id):document.getElementsByName(t)[0],l=e.errorList[t].id+"-error",r.setAttribute("id",l),i.setAttribute("aria-labelledBy",l),s=i.parentNode,0===s.getElementsByClassName(e.options.errorMessagesClass).length&&s.insertBefore(r,i.nextSibling));window.scrollTo(0,this.element.offsetTop),document.getElementsByClassName(e.options.errorMessagesClass)[0].focus()},makeErrorList:function(){var e,t,i;this.errorList={};for(i in this.validatebleElements)this.validatebleElements.hasOwnProperty(i)&&(t=this.validatebleElements[i].isGrouped,e=t?this.validatebleElements[i].DOMElement.getAttribute("name"):this.validatebleElements[i].DOMElement.getAttribute("id"),this.errorList[e]={error:null,id:this.validatebleElements[i].DOMElement.getAttribute("id")});return this},addError:function(e,t,i){var s=this,r=e,l=null,n=null,a=null;l=i?r.getAttribute("name"):r.getAttribute("id"),console.log(l),n=r.getAttribute("id"),a=i?r.parentNode:r,-1===a.className.indexOf("form-error")&&(a.className+=" form-error"),r.setAttribute("aria-invalid","true"),s.errorList.hasErrors=!0,s.errorList[l].error=t},deleteError:function(e,t){var i=e,s=null,r=null,l=null;s=t?i.getAttribute("name"):i.getAttribute("id"),r=i.getAttribute("id"),l=t?i.parentNode:i,l.className.indexOf("form-error")>-1&&(l.className=l.className.split(" form-error").join("")),console.log("deleting error..."),i.setAttribute("aria-invalid","false"),this.errorList[s].error=null},test:function(){var e=null,t=null,i=null,s=(this.validatebleElements.length,this);this.makeErrorList(),this.groups=[];for(e in this.validatebleElements)this.validatebleElements.hasOwnProperty(e)&&(t=this.validatebleElements[e].getError(),t&&(this.validatebleElements[e].isGrouped&&"checked"===this.groups[this.validatebleElements[e].DOMElement.getAttribute("name")]||s.addError(this.validatebleElements[e].DOMElement,t,this.validatebleElements[e].isGrouped),this.validatebleElements[e].ph||this.validatebleElements[e].placeHolder()));this.errorList.hasErrors?(s.options.displayMessages&&(s.options.listMessages?s.listErrorMessages():s.displayInlineErrorMessages()),this.options.fail.call()):i=this.options.pass?this.options.pass.call():this.element.submit()}},{init:function(e,t){var i=document.querySelectorAll(e),s=[],l=null,n=i.length;for(l=0;n>l;l+=1)i[l].hasAttribute("novalidate")||(s[l]=new r(i[l],t))}}});
