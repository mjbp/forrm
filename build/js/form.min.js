(function(e,t,i){"use strict";"function"==typeof define&&define.amd?define(i):t[e]=i()})("Form",this,function(e,t){"use strict";function i(e,t){var s=null;for(s in t)t.hasOwnProperty(s)&&(t[s]&&t[s].constructor&&t[s].constructor===Object?(e[s]=e[s]||{},i(e[s],t[s])):e[s]=t[s]);return e}function s(e,t){this.DOMElement=e,this.parent=t,this.init()}function r(e,t){this.element=e,this.options=i(n,t),this.init()}e=e||"Form",t=t||this;var n={augmentHTML5:!0,customErrorMessage:!1,displayMessages:!0,listMessages:!0,listTitle:"We couldn't submit the form, please check your answers:",errorMessagesClass:"form-error-message",errorMessageElement:"p",errorMessages:{valueMissing:{text:"This field is required",email:"This field is required",tel:"This field is required",checkbox:"Check at least one of the required boxes",radio:"Select one of the required radio options"},patternMismatch:{tel:"Enter a valid phone number",email:"Enter a valid email address",text:"Please match the requested format"}},patterns:{email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",tel:"[\\w\\d\\s\\(\\)\\.+-]+"},fail:function(){},pass:!1};return s.prototype={init:function(){this.ph="placeholder"in document.createElement("input"),this.type=this.DOMElement.getAttribute("type")||"text",this.DOMElement.validityState=this.DOMElement.validityState||this.defaultValidityState(),this.DOMElement.checkValidity=this.DOMElement.checkValidity||this.getValidityState,this.ph||this.placeHolder()},defaultValidityState:function(){return{valid:!1,stepMismatch:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,tooLong:!1,typeMismatch:!1,valueMissing:!0}},getValidityState:function(){return this.validityState.valid},setValidityState:function(){var e,t=this.DOMElement.getAttribute("pattern")||this.parent.options.patterns[this.type],i=null;return""!==this.DOMElement.value&&("radio"!==this.type&&"checkbox"!==this.type||this.DOMElement.checked)?(this.DOMElement.validityState.valueMissing=!1,e=RegExp(t,""),e.test(this.DOMElement.value)?this.DOMElement.validityState.valid=!0:(this.DOMElement.validityState.valid=!1,this.DOMElement.validityState.patternMismatch=!0,i=this.parent.options.errorMessages.patternMismatch[this.type])):(this.DOMElement.validityState.valid=!1,this.DOMElement.validityState.valueMissing=!0,i=this.parent.options.errorMessages.valueMissing[this.type]),this.DOMElement.validationMessage=i,this},placeHolder:function(){var e=function(e){e.stopPropagation(),this.value="",this.className=this.className.split("form-placeholder").join("")},t=function(e){e.stopPropagation(),""===this.value&&(this.value=this.getAttribute("placeholder"),this.className+=" form-placeholder")};this.DOMElement.getAttribute("placeholder")&&(this.DOMElement.addEventListener("focus",e,!1),this.DOMElement.addEventListener("blur",t,!1),""===this.DOMElement.value&&(this.DOMElement.value=this.DOMElement.getAttribute("placeholder"),this.DOMElement.className+=" form-placeholder"))},clearPlaceholder:function(){return this.DOMElement.value===this.DOMElement.getAttribute("placeholder")&&(this.DOMElement.value=""),this},validate:function(){var e=null;return this.DOMElement.value,this.DOMElement.getAttribute("pattern")||this.parent.options.patterns[this.type],this.ph||this.clearPlaceholder(),this.parent.HTML5||this.setValidityState(),e=this.DOMElement.checkValidity(),e?(("checkbox"===this.type||"radio"===this.type)&&(this.parent.groups[this.DOMElement.getAttribute("name")]="checked",this.parent.errors[this.DOMElement.getAttribute("name")]&&delete this.parent.errors[this.DOMElement.getAttribute("name")]),!1):this.parent.options.customErrorMessage?"radio"!==this.type&&"checkbox"!==this.type?this.DOMElement.validity.valueMissing&&this.parent.options.errorMessages.valueMissing[this.type]||this.DOMElement.validity.patternMismatch&&this.parent.options.errorMessages.patternMismatch[this.type]:"checked"!==this.parent.groups[this.DOMElement.getAttribute("name")]?(this.parent.groups[this.DOMElement.getAttribute("name")]="not-checked",this.parent.options.errorMessages.valueMissing[this.type]):void 0:this.DOMElement.validationMessage}},r.prototype={HTML5:!1,groups:[],init:function(){var e=0,t=0;if(this.HTML5="noValidate"in document.createElement("form"),!this.HTML5||this.options.augmentHTML5)for(this.fields=this.element.querySelectorAll("input, textarea"),this.elements=[],t=this.fields.length,this.element.querySelector("input[type=submit]").addEventListener("click",this,!1),this.element.querySelector("input[type=submit]").addEventListener("onkeypress",this,!1),e=0;t>e;e+=1)this.elements[e]=new s(this.fields[e],this)},handleEvent:function(e){(!this.HTML5||this.options.augmentHTML5)&&"click"===e.type&&(e.preventDefault(),this.clearErrors().test())},writeInline:function(e){var t=this,i=document.createElement(t.options.errorMessageElement);return i.textContent=e,i.className=t.options.errorMessagesClass,i.setAttribute("role","alert"),i},clearErrors:function(){var e=this,t=null,i=null,s=e.fields.length;if(e.element.querySelectorAll(".form-error").length>0)for(i=0;s>i;i+=1)e.fields[i].className.indexOf("form-error")>-1&&(e.fields[i].className=e.fields[i].className.split("form-error").join(""),e.options.listMessages||(e.fields[i].removeAttribute("aria-labelledBy"),e.fields[i].removeAttribute("aria-invalid"),t=e.fields[i].nextElementSibling,t&&t.parentNode.removeChild(t)));return e},listErrorMessages:function(){var e=this,t=this.element.querySelector(".form-error-list"),i=document.createElement("dl"),s=document.createElement("dt"),r=document.createElement("dd"),n=document.createElement("ol"),l=document.createElement("li"),a=document.createElement("a"),o=null,h=null,u=null;e.errors.length,t&&t.parentElement.removeChild(t),s.innerHTML=e.options.listTitle,i.appendChild(s),i.appendChild(r),i.className="form-error-list",i.setAttribute("role","alert"),r.appendChild(n);for(u in e.errors)e.errors.hasOwnProperty(u)&&"hasErrors"!==u&&(o=l.cloneNode(!0),h=a.cloneNode(!0),h.setAttribute("href","#"+e.errors[u].id),h.setAttribute("id",u+"-error"),h.innerHTML=e.errors[u].error,o.appendChild(h),n.appendChild(o));e.element.insertBefore(i,e.element.firstChild),window.scrollTo(0,i.offsetTop),i.focus()},displayInlineErrorMessages:function(){var e=this,t=null,i=null,s=null,r=null,n=null;console.log("To do\n - test displaying of inline errors");for(t in e.errors)e.errors.hasOwnProperty(t)&&"hasErrors"!==t&&(r=e.writeInline(e.errors[t].error),i=null!==document.getElementById(t)?document.getElementById(e.errors[t].id):document.getElementsByName(t)[0],n=e.errors[t].id+"-error",r.setAttribute("id",n),i.setAttribute("aria-labelledBy",n),s=i.parentNode,0===s.getElementsByClassName(e.options.errorMessagesClass).length&&s.insertBefore(r,i.nextSibling));window.scrollTo(0,this.element.offsetTop),document.getElementsByClassName(e.options.errorMessagesClass)[0].focus()},addError:function(e,t,i){var s=this,r=e,n=null,l=null,a=null;n=i?r.getAttribute("name"):r.getAttribute("id"),l=r.getAttribute("id"),a=i?r.parentNode:r,a.className+=" form-error",r.setAttribute("aria-invalid","true"),s.errors.hasErrors=!0,s.errors[n]={error:t,id:l}},test:function(){var e=null,t=null,i=null,s=null,r=this.elements.length,n=this;for(this.errors={},this.groups=[],e=0;r>e;e+=1)t=this.elements[e].DOMElement,"submit"!==t.getAttribute("type")&&null!==t.getAttribute("required")&&"hidden"!==t.getAttribute("type")&&null===t.getAttribute("novalidate")&&(i=this.elements[e].validate(),i&&(n.addError(this.elements[e].DOMElement,i,"checkbox"===this.elements[e].type||"radio"===this.elements[e].type),this.elements[e].ph||this.elements[e].placeHolder()));this.errors.hasErrors?(n.options.displayMessages&&(n.options.listMessages?n.listErrorMessages():n.displayInlineErrorMessages()),this.options.fail.call()):s=this.options.pass?this.options.pass.call():this.element.submit()}},{init:function(e,t){var i=document.querySelectorAll(e),s=[],n=null,l=i.length;for(n=0;l>n;n+=1)i[n].hasAttribute("novalidate")||(s[n]=new r(i[n],t))}}});
