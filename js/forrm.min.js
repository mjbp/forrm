/**
 * @name Forrm: Clientside form validation framework using contraintValidation
 * @version 0.2.0 Mon, 02 Feb 2015 16:24:09 GMT
 * @author mjbp
 * @license 
 * @url https://github.com/mjbp/forrm/
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Forrm=e()}(this,function(){"use strict";function t(t,e){this.DOMElement=t,this.parent=e,this.forrm=e.parent,this.init()}function e(t,e,i,s,r){this.name=t,this.elements=e,this.type=i,this.min=+s||1,this.max=+r||null,this.parent=e[0].parent,this.init(e)}function i(t){this.parent=t,this.init()}function s(t,e,i){this.stepNum=i,this.parent=e,this.DOMElement=t,this.init()}function r(t,e){if("undefined"===t)throw new Error("No element has been supplied");this.DOMElement=t,this.options=a.extend({},n,e),this.init()}var n={augmentHTML5:!0,autocomplete:!0,customErrorMessage:!1,displayMessages:!0,firstErrorOnly:!1,css:{prefix:"forrm-",successClass:"success",errorClass:"error",errorMessageClass:"error-message",errorListClass:"error-list",disabledClass:"disabled",hiddenClass:"hidden",buttonClass:"btn",buttonNextClass:"btn--submit",buttonPreviousClass:"btn--previous",stepPrefix:"step-"},listMessages:!1,listTitle:"We couldn't submit the form, please check your answers:",errorMessageElement:"span",errorMessages:{text:{valueMissing:"This field is required",patternMismatch:"Match the requested format"},url:{valueMissing:"This field is required",patternMismatch:"Enter a valid URL",typeMismatch:"Enter a valid URL"},search:{valueMissing:"This field is required",patternMismatch:"Match the requested format"},email:{valueMissing:"This field is required",patternMismatch:"Enter a valid email address",typeMismatch:"Enter a valid email address"},tel:{valueMissing:"This field is required",patternMismatch:"Enter a valid phone number"},password:{valueMissing:"This field is required",patternMismatch:"Enter a valid password"},select:{valueMissing:"Choose an option"},checkbox:{valueMissing:"Check at least one of the required boxes"},radio:{valueMissing:"Select one of the required radio options"},number:{valueMissing:"This field is required",patternMismatch:"Enter a valid number",typeMismatch:"Enter a valid number"},file:{valueMissing:"Choose a file"},group:{valueMissing:"One of these fields is required",patternMismatch:"Match the requested format one on of these fields"}},fail:!1,pass:!1,conditionalConstraint:!1,customConstraint:!1,patterns:{email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",tel:"[\\w\\d\\s\\(\\)\\.+-]+",number:"[\\d]"}},a={extend:function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},forEach:function(t,e,i){var s,r=t.length;if([].forEach)return t.forEach(e);for(s=0;r>s;s+=1)t.hasOwnProperty(s)&&e.call(i,t[s],s,t)},on:function(t,e,i){for(var s=e.split(" "),r=0;r<s.length;r++)t.addEventListener?t.addEventListener(s[r],i,!1):t.attachEvent("on"+s[r],i)},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stopImmediatePropagation:function(t){t.stopImmediatePropagation?t.stopImmediatePropagation():t.cancelBubble=!0}};t.prototype={init:function(){var t=this,e=function(e){t.forrm.liveValidating&&(a.stopImmediatePropagation(e),t.parent.validationList[t.errorGroup].element.validate(),t.forrm.options.listMessages?t.forrm.UI.listErrorMessages():t.forrm.UI.updateInlineErrors(t))};null!==this.DOMElement.getAttribute("required")&&(this.type="input"===this.DOMElement.tagName.toLowerCase()&&this.DOMElement.getAttribute("type")||"textarea"===this.DOMElement.tagName.toLowerCase()&&"text"||this.DOMElement.tagName.toLowerCase(),!this.forrm.options.customErrorMessage||this.type in this.forrm.options.errorMessages||(this.type="text"),this.testCustomConstraint=!!this.DOMElement.getAttribute("data-forrm-custom-constraint")&&this.forrm.options.customConstraint[this.DOMElement.getAttribute("data-forrm-custom-constraint")]||!1,this.errorGroup=this.DOMElement.getAttribute("id"),this.validity=this.DOMElement.validity||this.defaultValidity(),"autocomplete"in this.DOMElement&&!this.forrm.options.autocomplete&&this.DOMElement.setAttribute("autocomplete","off"),null!==this.DOMElement.getAttribute("data-forrm-conditional")&&this.addConditional(),a.on(this.DOMElement,"click keyup input paste change",e))},defaultValidity:function(){return{valid:!1,stepMismatch:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,tooLong:!1,typeMismatch:!1,valueMissing:!0}},getValidity:function(){return this.validity.valid},setValidity:function(){var t,e=this.DOMElement.getAttribute("pattern")||this.forrm.options.patterns[this.type];return this.validationMessage=null,""!==this.DOMElement.value.replace(/^\s+/g,"").replace(/\s+$/g,"")&&("radio"!==this.type&&"checkbox"!==this.type||this.DOMElement.checked)?(this.validity.valueMissing=!1,t=new RegExp(e,""),t.test(this.DOMElement.value)?this.validity.valid=!0:(this.validity.valid=!1,"text"===this.type?this.validity.patternMismatch=!0:this.validity.typeMismatch=!0,this.validationMessage=this.forrm.options.errorMessages[this.type].patternMismatch)):(this.validity.valid=!1,this.validity.valueMissing=!0,this.validationMessage=this.forrm.options.errorMessages[this.type].valueMissing),this},setGroup:function(t){return this.group=t,this.errorGroup=t.name,this.type="custom"===t.type&&"group"||this.type,this},addError:function(t,e){return this.DOMElement.parentNode.className=this.DOMElement.parentNode.className.split(" "+this.forrm.options.css.prefix+this.forrm.options.css.successClass).join(""),-1===this.DOMElement.parentNode.className.indexOf(this.forrm.options.css.prefix+this.forrm.options.css.errorClass)&&(this.DOMElement.parentNode.className+=" "+this.forrm.options.css.prefix+this.forrm.options.css.errorClass),this.DOMElement.setAttribute("aria-invalid","true"),e||this.parent.manageValidationList(this.errorGroup,t),this},removeError:function(t){return this.DOMElement.parentNode.className=this.DOMElement.parentNode.className.split(" "+this.forrm.options.css.prefix+this.forrm.options.css.errorClass).join(""),this.DOMElement.setAttribute("aria-invalid","false"),this.DOMElement.removeAttribute("aria-labelledby"),t||this.parent.manageValidationList(this.errorGroup,null),this},addSuccess:function(t){return this.removeError(t),-1===this.DOMElement.parentNode.className.indexOf(this.forrm.options.css.prefix+this.forrm.options.css.successClass)&&(this.DOMElement.parentNode.className+=" "+this.forrm.options.css.prefix+this.forrm.options.css.successClass),this},test:function(){return this.forrm.HTML5||this.setValidity(),this.testCustomConstraint&&(this.forrm.HTML5?this.DOMElement.setCustomValidity(this.testCustomConstraint.call(this.DOMElement)):""!==this.testCustomConstraint.call(this.DOMElement)&&(this.validity.valid=!1,this.validity.customError=this.testCustomConstraint.call(this.DOMElement),this.forrm.HTML5||(this.validationMessage=this.validity.customError))),this.DOMElement.checkValidity instanceof Function&&this.DOMElement.checkValidity()||this.getValidity()},validate:function(){this.test()?this.addSuccess():this.addError(this.getError())},getError:function(){return this.forrm.options.customErrorMessage?this.forrm.options.errorMessages[this.type][this.validity.valueMissing&&"valueMissing"||this.validity.patternMismatch&&"patternMismatch"||this.validity.typeMismatch&&"typeMismatch"]:null!==this.DOMElement.getAttribute("data-forrm-custom-error")?this.DOMElement.getAttribute("data-forrm-custom-error"):this.DOMElement.validationMessage||this.validationMessage},addConditional:function(){var t=this,e=this.DOMElement.getAttribute("data-forrm-conditional"),i=function(e){a.stopImmediatePropagation(e),t.conditionalConstraint.call(t.DOMElement)?t.forrm.UI.toggleEnabled(t.dependents,!0):t.forrm.UI.toggleEnabled(t.dependents,null)};t.dependents=document.querySelectorAll("."+e+" input, ."+e+" textarea, ."+e+"select"),t.conditionalConstraint=!!t.forrm.options.conditionalConstraint&&t.forrm.options.conditionalConstraint[e]||function(){return""!==this.value},a.on(t.DOMElement,"change",i)}},e.prototype={init:function(){this.valid=!0},addError:function(t){for(var e=0;e<this.elements.length;e++)this.elements[e].addError(t);return this},removeError:function(){for(var t=0;t<this.elements.length;t++)this.elements[t].removeError()},addSuccess:function(){this.removeError();for(var t=0;t<this.elements.length;t++)this.elements[t].addSuccess();return this},validate:function(){var t=null;this.numValid=0;for(var e=0;e<this.elements.length;e++)this.elements[e].test()?this.numValid++:(this.elements[e].addError(null,!0),this.valid=!1,t=this.elements[e].getError());return this.numValid>=+this.min&&null===this.max||this.numValid>=+this.min&&this.max&&this.numValid<=+this.max?(this.valid=!0,void this.addSuccess()):void(t&&this.addError(t))},getName:function(){return this.name}},i.prototype={init:function(){this.write=this.parent.options.displayMessages?this.parent.options.listMessages?this.listErrorMessages:this.displayInlineErrorMessages:function(){return this}},addInlineError:function(t){var e,i=document.createElement(this.parent.options.errorMessageElement);i.innerHTML=this.parent.validationList[t].error,i.className=this.parent.options.css.prefix+this.parent.options.css.errorMessageClass,i.setAttribute("role","alert"),i.setAttribute("id",t+"-error"),e=document.getElementById(this.parent.validationList[t].id),e.setAttribute("aria-labelledBy",t+"-error"),e.parentNode.appendChild(i)},clearInlineErrors:function(){var t=this.parent.DOMElement.querySelectorAll("."+this.parent.options.css.prefix+this.parent.options.css.errorMessageClass);if(0!==t.length){for(var e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e]);return this}},updateInlineErrors:function(t){var e=document.getElementById(t.errorGroup+"-error");return t.parent.validationList[t.errorGroup].error?e?(e.textContent=t.parent.validationList[t.errorGroup].error,this):(this.addInlineError(t.errorGroup),this):e?(e.parentNode.removeChild(e),this):this},displayInlineErrorMessages:function(){this.clearInlineErrors();for(var t in this.parent.validationList)this.parent.validationList.hasOwnProperty(t)&&this.parent.validationList[t].error&&this.addInlineError(t)},listErrorMessages:function(){var t=this.parent.DOMElement.querySelector("."+this.parent.options.css.prefix+this.parent.options.css.errorListClass),e=document.createElement("dl"),i=document.createElement("dt"),s=document.createElement("dd"),r=document.createElement("ol"),n=document.createElement("li"),a=document.createElement("a"),o=null,l=null;if(this.errorListHolder=e,t&&t.parentElement.removeChild(t),0===this.parent.steps[this.parent.currentStep].countErrors())return this;i.innerHTML=this.parent.options.listTitle,e.appendChild(i),e.appendChild(s),e.className=this.parent.options.css.prefix+this.parent.options.css.errorListClass,e.setAttribute("role","alert"),s.appendChild(r);for(var h in this.parent.validationList)this.parent.validationList.hasOwnProperty(h)&&this.parent.validationList[h].error&&(o=n.cloneNode(!0),l=a.cloneNode(!0),l.setAttribute("href","#"+this.parent.validationList[h].id),l.setAttribute("id",h+"-error"),l.innerHTML=this.parent.validationList[h].error,o.appendChild(l),r.appendChild(o));this.parent.DOMElement.insertBefore(e,this.parent.DOMElement.firstChild)},toggleEnabled:function(t,e){for(var i,s=0;i=t[s];++s)null!==e?(i.parentNode.className=i.parentNode.className.split(" "+this.parent.options.css.prefix+this.parent.options.css.disabledClass).join(""),i.removeAttribute("disabled")):(i.parentNode.className=i.parentNode.className+" "+this.parent.options.css.prefix+this.parent.options.css.disabledClass,i.setAttribute("disabled","disabled"));this.parent.build()}},s.prototype={init:function(){var s=[];this.fields=this.DOMElement.querySelectorAll("input, textarea, select"),this.validatebleElements={},this.unvalidatebleElements={},this.groups={};for(var r,n=0;r=this.fields[n];n++)if(!("submit"===r.getAttribute("type")||"reset"===r.getAttribute("type")||"button"===r.getAttribute("type")||"hidden"===r.getAttribute("type")||null!==r.getAttribute("disabled")&&""!==r.getAttribute("disabled")||null!==r.getAttribute("novalidate")&&""!==r.getAttribute("novalidate")))if(null!==r.getAttribute("required")||""!==r.getAttribute("required")){if(this.validatebleElements[r.getAttribute("id")]=new t(r,this),("checkbox"===r.getAttribute("type")||"radio"===r.getAttribute("type")||null!==r.getAttribute("data-forrm-group"))&&s.push(this.validatebleElements[r.getAttribute("id")]),(void 0===this.fields[n+1]||!r.getAttribute("data-forrm-group")&&r.getAttribute("name")!==this.fields[n+1].getAttribute("name")||n-1===this.fields.length||r.getAttribute("data-forrm-group")!==this.fields[n+1].getAttribute("data-forrm-group"))&&s.length>0){var a=r.getAttribute("data-forrm-group")||r.getAttribute("name"),o=r.getAttribute("data-forrm-group")?"custom":"checked",l=r.getAttribute("data-forrm-group-min")||1,h=r.getAttribute("data-forrm-group-max")||null;this.groups[a]=new e(a,s,o,l,h);for(var u=0;u<s.length;u++)s[u].setGroup(this.groups[a]);s=[]}}else this.unvalidatebleElements[r.getAttribute("id")]=new t(r,this);return this.parent.numSteps>1&&this.addButtons(),this.makeValidationList(),this.parent.UI=new i(this.parent),this},hide:function(){this.DOMElement.className=this.DOMElement.className+" "+this.parent.options.css.prefix+this.parent.options.css.hiddenClass},show:function(){this.DOMElement.className=this.DOMElement.className.split(" "+this.parent.options.css.prefix+this.parent.options.css.hiddenClass).join("")},addButtons:function(){var t,e,i=this,s=document.createElement("button");return t=s.cloneNode(!0),this.stepNum+1!==this.parent.numSteps&&(t.className=this.parent.options.css.prefix+this.parent.options.css.buttonClass+" "+this.parent.options.css.prefix+this.parent.options.css.buttonNextClass,t.innerHTML="Submit",a.on(t,"click onkeypress",function(t){i.parent.handleEvent.call(i.parent,t)}),this.DOMElement.appendChild(t)),0!==this.stepNum&&(e=s.cloneNode(!0),e.className=this.parent.options.css.prefix+this.parent.options.css.buttonClass+" "+this.parent.options.css.prefix+this.parent.options.css.buttonPreviousClass,e.innerHTML="Previous",a.on(e,"click onkeypress",function(t){i.parent.changeStep.call(i.parent,!1,t)}),this.DOMElement.appendChild(e)),this},makeValidationList:function(){this.validationList={};for(var t in this.validatebleElements)this.validatebleElements.hasOwnProperty(t)&&(this.validationList[this.validatebleElements[t].errorGroup]={error:null,element:this.groups[this.validatebleElements[t].errorGroup]||this.validatebleElements[t],id:this.groups[this.validatebleElements[t].errorGroup]?this.groups[this.validatebleElements[t].errorGroup].elements[0].DOMElement.getAttribute("id"):document.getElementById(this.validatebleElements[t].errorGroup).getAttribute("id")});return this.validationList},manageValidationList:function(t,e){return this.validationList[t].error=e,this},countErrors:function(){var t=0;for(var e in this.validationList)this.validationList.hasOwnProperty(e)&&null!==this.validationList[e].error&&t++;return t}},r.prototype={HTML5:!1,build:function(){var t;t=this.DOMElement.querySelectorAll("[data-forrm-step]"),this.numSteps=t.length||1,this.steps=[],t=t.length>0&&t||[this.DOMElement],this.currentStep=0,this.numSteps>1&&(this.DOMElement.className+=" "+this.options.css.prefix+this.options.css.stepPrefix+"1");for(var e=0;e<t.length;++e)this.steps.push(new s(t[e],this,e)),0!==e&&this.steps[e].hide();return this},init:function(){var t=this;return this.HTML5="noValidate"in document.createElement("form"),this.liveValidating=!1,this.go=this.options.pass||this.DOMElement.submit,(!this.HTML5||this.options.augmentHTML5)&&("autocomplete"in this.DOMElement&&!this.options.autocomplete&&this.DOMElement.setAttribute("autocomplete","off"),this.build(),null!==this.DOMElement.querySelector("input[type=submit]")&&a.on(this.DOMElement.querySelector("input[type=submit]"),"click onkeypress",function(e){t.handleEvent.call(t,e)})),this},handleEvent:function(t){(!this.HTML5||this.options.augmentHTML5)&&(this.liveValidating=!0,("click"===t.type||"onkeypress"===t.type)&&(a.preventDefault(t),a.stopImmediatePropagation(t),this.test.call(this)))},changeStep:function(t,e){var i=!!t&&this.currentStep+1||this.currentStep-1;return e&&a.preventDefault(e),this.steps[this.currentStep].hide(),this.DOMElement.className=this.DOMElement.className.split(" "+this.options.css.prefix+this.options.css.stepPrefix+(+this.currentStep+1)).join(" "+this.options.css.prefix+this.options.css.stepPrefix+(+i+1)),this.steps[i].show(),this.currentStep=i,this},test:function(){var t=this;this.validationList=this.steps[this.currentStep].makeValidationList();for(var e in this.validationList)if(this.validationList[e].element.validate(),this.options.firstErrorOnly&&this.validationList[e].error)break;this.steps[this.currentStep].countErrors()>0?(t.UI.write(),this.options.listMessages?this.UI.errorListHolder.focus():document.querySelector("."+this.options.css.prefix+this.options.css.errorMessageClass).focus(),"function"==typeof this.options.fail&&this.options.fail.call()):this.currentStep===this.numSteps-1?this.go.call(this.DOMElement):this.changeStep(!0)}};var o={init:function(t,e){if("querySelectorAll"in document){var i=document.querySelectorAll(t),s=[],n=null,a=i.length;for(n=0;a>n;n+=1)i[n].hasAttribute("novalidate")||(s[n]=new r(i[n],e));return s}throw new Error("Sorry, your browser is not supported.")}};return o});